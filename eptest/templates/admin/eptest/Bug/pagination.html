{% load admin_list %}
{% load i18n %}
{% load simpletags %}
<div id="pagination">
    {% django_version_is_gte_32x as is_32x %}
    {% if pagination_required %}
        <el-pagination
            background
            @current-change="handleCurrentChange"
            {% if is_32x %}
            :current-page="{{ cl.page_num }}"
            {% else %}
            :current-page="{{ cl.page_num|add:'1' }}"
            {% endif %}
            :page-sizes="[10, 20, 50, 100]"
            :page-size.sync="pageSize"
            layout="total,prev, pager, next, jumper, sizes"
            :total="{{ cl.result_count|to_str }}">
        </el-pagination>
    {% endif %}
</div>
<script type="text/javascript">
    $(function () {
        new Vue({
            el: "#pagination",
            data: {
                pageSize: {{ cl.list_per_page }}
            },
            methods: {
                handleCurrentChange: function (page) {
                    {% if is_32x %}
                        page_go(page, this.pageSize);
                    {% else %}
                        page_go(page - 1, this.pageSize);
                    {% endif %}
                    console.log("cc");
                },
                handleSizeChange: function (size) {
                    this.pageSize = size;
                    console.log("cc2");
                    // 将每页显示条数传递给后端，例如使用一个隐藏的表单字段
                    $("#changelist-search input[name='per_page']").val(size);
                    $("#changelist-search").submit();
                }


            }
        });

        function page_go(p, pageSize) {
            $("#changelist-search input[name='p']").val(p);
            $("#changelist-search input[name='per_page']").val(pageSize);
            $("#changelist-search").submit();
        }
    });
</script>
